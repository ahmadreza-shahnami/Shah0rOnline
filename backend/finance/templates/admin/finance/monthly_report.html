{% extends "admin/base_site.html" %}
{% block content %}
<h1>Ú¯Ø²Ø§Ø±Ø´ Ù…Ø§Ù„ÛŒ Ù…Ø§Ù‡Ø§Ù†Ù‡</h1>

<form method="get">
  <label>Ù…Ø¯Ø±Ø³Ù‡:</label>
  <select name="school_id">
    {% for s in schools %}
      <option value="{{ s.id }}" {% if selected_school == s.id %}selected{% endif %}>{{ s.name }}</option>
    {% endfor %}
  </select>

  <label>Ù…Ø§Ù‡:</label>
  <input type="number" name="month" value="{{ month }}" min="1" max="12">

  <label>Ø³Ø§Ù„:</label>
  <input type="number" name="year" value="{{ year }}">

  <button type="submit">Ù†Ù…Ø§ÛŒØ´</button>
</form>

{% if report %}
  <h2>Ù†ØªÛŒØ¬Ù‡:</h2>
  <ul>
    <li>Ø¯Ø±Ø¢Ù…Ø¯: {{ report.income }} ØªÙˆÙ…Ø§Ù†</li>
    <li>Ø­Ù‚ÙˆÙ‚ Ù¾Ø±Ø³Ù†Ù„: {{ report.salary_total }} ØªÙˆÙ…Ø§Ù†</li>
    <li>Ù‡Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ø«Ø§Ø¨Øª: {{ report.expenses_total }} ØªÙˆÙ…Ø§Ù†</li>
    <li>Ú©Ù„ Ù‡Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§: {{ report.total_expenses }} ØªÙˆÙ…Ø§Ù†</li>
    <li><strong>Ø³ÙˆØ¯/Ø²ÛŒØ§Ù†: {{ report.profit }} ØªÙˆÙ…Ø§Ù†</strong></li>
  </ul>

  <hr>

  <h3>Ù¾Ø±Ø¯Ø§Ø®Øªâ€ŒÙ‡Ø§ÛŒ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù†</h3>
  <table border="1" cellspacing="0" cellpadding="5">
    <tr>
      <th>Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²</th>
      <th>Ù…Ø¨Ù„Øº</th>
      <th>ØªØ§Ø±ÛŒØ®</th>
    </tr>
    {% for p in report.payments %}
    <tr>
      <td>{{ p.student.name }}</td>
      <td>{{ p.amount }}</td>
      <td>{{ p.payment_date }}</td>
    </tr>
    {% empty %}
    <tr><td colspan="3">Ù‡ÛŒÚ† Ù¾Ø±Ø¯Ø§Ø®ØªÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡</td></tr>
    {% endfor %}
  </table>

  <h3>Ø­Ù‚ÙˆÙ‚ Ù¾Ø±Ø³Ù†Ù„</h3>
  <table border="1" cellspacing="0" cellpadding="5">
    <tr>
      <th>Ù¾Ø±Ø³Ù†Ù„</th>
      <th>Ø­Ù‚ÙˆÙ‚</th>
    </tr>
    {% for s in report.salaries %}
    <tr>
      <td>{{ s.staff.name }}</td>
      <td>{{ s.total_salary }}</td>
    </tr>
    {% empty %}
    <tr><td colspan="2">Ù‡ÛŒÚ† Ø­Ù‚ÙˆÙ‚ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡</td></tr>
    {% endfor %}
  </table>

  <h3>Ù‡Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§</h3>
  <table border="1" cellspacing="0" cellpadding="5">
    <tr>
      <th>Ø¹Ù†ÙˆØ§Ù†</th>
      <th>Ù…Ø¨Ù„Øº</th>
      <th>ØªØ§Ø±ÛŒØ®</th>
    </tr>
    {% for e in report.expenses %}
    <tr>
      <td>{{ e.title }}</td>
      <td>{{ e.amount }}</td>
      <td>{{ e.expense_date }}</td>
    </tr>
    {% empty %}
    <tr><td colspan="3">Ù‡ÛŒÚ† Ù‡Ø²ÛŒÙ†Ù‡â€ŒØ§ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡</td></tr>
    {% endfor %}
  </table>

  <a href="{% url 'admin:monthly-report-pdf' %}?school_id={{ selected_school }}&month={{ month }}&year={{ year }}" target="_blank">
    ðŸ“„ Ø¯Ø§Ù†Ù„ÙˆØ¯ PDF
  </a>

  <a href="{% url 'admin:download-monthly-report-csv' %}?school_id={{ selected_school }}&month={{ month }}&year={{ year }}">
    ðŸ“Š Ø¯Ø§Ù†Ù„ÙˆØ¯ CSV
  </a>

{% endif %}
{% endblock %}
